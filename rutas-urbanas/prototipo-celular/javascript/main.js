var marcadores = new Array();
var paradasRutaBuenaVista;
var rutaBuenaVista;
var rutaLaEstacion;
var grupoCapas = new L.layerGroup();

// inicializa Leaflet
var map = L.map('map', {
    center: [18.893920, -96.929300],
    zoom: 15,
    maxZoom: 18,
    zoomControl: false
});

// add the OpenStreetMap tiles
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

// muestra la barra de escala en la esquina inferior izquierda
L.control.scale({ imperial: true, metric: true }).addTo(map);

/* Abre cuando hacen click en el boton */
function abrirMenuRutas() {
    document.getElementById("menuRutas").style.height = "100%";
}

/* Se cierra nav */  
function cerrarMenuRutas() {
    document.getElementById("menuRutas").style.height = "0%";
}

function abrirMenuParadasRutas() {
    document.getElementById("menuParadasRutas").style.width = "100%";
}

function cerrarMenuParadasRutas() {
    document.getElementById("menuParadasRutas").style.width = "0%";
    quitarParadasAutobus();
    map.removeLayer(rutaBuenaVista);
    abrirMenuRutas();
}

function quitarParadasAutobus() {
    for (let i = 0; i < marcadores.length; i++) {
        map.removeLayer(marcadores[i]);
    }
}

function agregandoParadasAutobus(arrayConParadas) {
    for (let i = 0; i < arrayConParadas.length; i++) {
        let marcadorParada = new L.marker(
            [arrayConParadas[i].lat,
            arrayConParadas[i].lon]);
        marcadores.push(marcadorParada);
        map.addLayer(marcadores[i]);
    }
}

function mostrarRutaBuenaVista() {
    paradasRutaBuenaVista = [
        { "lat": "18.88756787404418", "lon": "-96.926639657467604" },
        { "lat": "18.890274055302143", "lon": "-96.928918277844787" },
        { "lat": "18.888630867004395", "lon": "-96.927008628845215" },
        { "lat": "18.891276279464364", "lon": "-96.93009459413588" },
        { "lat": "18.892142213881016", "lon": "-96.92926587536931" },
        { "lat": "18.891007471829653", "lon": "-96.927861822769046" },
        { "lat": "18.885676665231586", "lon": "-96.921964148059487" },
        { "lat": "18.88370624743402", "lon": "-96.92104808986187" },
        { "lat": "18.894344139844179", "lon": "-96.929835928604007" },
        { "lat": "18.869962692260742", "lon": "-96.916923522949219" },
        { "lat": "18.865370750427246", "lon": "-96.911516189575195" },
        { "lat": "18.879874711856246", "lon": "-96.920801410451531" },
        { "lat": "18.873181343078613", "lon": "-96.913790702819824" },
        { "lat": "18.879510937258601", "lon": "-96.920345602557063" },
        { "lat": "18.87530330568552", "lon": "-96.916042333468795" },
        { "lat": "18.882767977192998", "lon": "-96.922872914001346" },
        { "lat": "18.868353366851807", "lon": "-96.912846565246582" },
        { "lat": "18.866872787475586", "lon": "-96.914262771606445" },
        { "lat": "18.871421813964844", "lon": "-96.915464401245117" },
        { "lat": "18.866829872131348", "lon": "-96.911494731903076" },
        { "lat": "18.865370750427246", "lon": "-96.91288948059082" },
        { "lat": "18.869919776916504", "lon": "-96.914112567901611" },
        { "lat": "18.868417739868164", "lon": "-96.915550231933594" },
        { "lat": "18.874855041503906", "lon": "-96.915786266326904" }
    ];
    let coordenadasRutaBuenaVista = [
        [18.893920, -96.929300],
        [18.893610, -96.929690],
        [18.892930, -96.930360],
        [18.892360, -96.929560],
        [18.89178, -96.92885],
        [18.89178, -96.92885],
        [18.89127, -96.92814],
        [18.89061, -96.92748],
        [18.89029, -96.92714],
        [18.88996, -96.9268],
        [18.8894, -96.92624],
        [18.88913, -96.92592],
        [18.88899, -96.92576],
        [18.88891, -96.92567],
        [18.88871, -96.92545],
        [18.8884, -96.9251],
        [18.88767, -96.92417],
        [18.88684, -96.9233],
        [18.88676, -96.92322],
        [18.8858, -96.92211],
        [18.88553, -96.92179],
        [18.88459, -96.92152],
        [18.88432, -96.92142],
        [18.88428, -96.9214],
        [18.88423, -96.92138],
        [18.8841, -96.9213],
        [18.88356, -96.92091],
        [18.88271, -96.92029],
        [18.88217, -96.91975],
        [18.88165, -96.92015],
        [18.88164, -96.92016],
        [18.88105, -96.92065],
        [18.88045, -96.92121],
        [18.88038, -96.92129],
        [18.88031, -96.92123],
        [18.87997, -96.92093],
        [18.87972, -96.92069],
        [18.87909, -96.92009],
        [18.87823, -96.91931],
        [18.87803, -96.91912],
        [18.87773, -96.91884],
        [18.87743, -96.91856],
        [18.87742, -96.91856],
        [18.87717, -96.91828],
        [18.87693, -96.91801],
        [18.87666, -96.91771],
        [18.87642, -96.91744],
        [18.87612, -96.91711],
        [18.87553, -96.91645],
        [18.8747, -96.91557],
        [18.87463, -96.91549],
        [18.87383, -96.9146],
        [18.87365, -96.91439],
        [18.87356, -96.91429],
        [18.87337, -96.91404],
        [18.87315, -96.91375],
        [18.873, -96.9139],
        [18.8726, -96.91428],
        [18.87246, -96.91441],
        [18.87207, -96.91479],
        [18.87137, -96.91548],
        [18.8706, -96.91481],
        [18.86985, -96.91412],
        [18.86943, -96.91376],
        [18.86909, -96.91346],
        [18.86834, -96.9128],
        [18.86757, -96.91211],
        [18.86681, -96.91145],
        [18.86605, -96.91075],
        [18.86533, -96.91144],
        [18.86472, -96.91217],
        [18.86475, -96.91224],
        [18.86478, -96.91228],
        [18.86479, -96.91229],
        [18.86482, -96.91232],
        [18.8649, -96.9124],
        [18.86506, -96.91254],
        [18.86537, -96.91284],
        [18.86612, -96.91353],
        [18.86639, -96.91378],
        [18.8668, -96.91415],
        [18.86686, -96.9142],
        [18.86762, -96.91486],
        [18.86838, -96.91555],
        [18.86838, -96.91555],
        [18.86914, -96.91621],
        [18.86935, -96.91639],
        [18.86981, -96.91684],
        [18.86984, -96.91686],
        [18.86986, -96.91688],
        [18.86988, -96.91688],
        [18.86989, -96.91688],
        [18.8699, -96.91688],
        [18.86991, -96.91688],
        [18.86994, -96.91685],
        [18.87063, -96.91618],
        [18.87097, -96.91586],
        [18.87137, -96.91548],
        [18.87207, -96.91479],
        [18.87246, -96.91441],
        [18.8726, -96.91428],
        [18.873, -96.9139],
        [18.87315, -96.91375],
        [18.87322, -96.9137],
        [18.87328, -96.91379],
        [18.87347, -96.91403],
        [18.87378, -96.91441],
        [18.87437, -96.91505],
        [18.87461, -96.91531],
        [18.87471, -96.91542],
        [18.87477, -96.9155],
        [18.87562, -96.91642],
        [18.87618, -96.91704],
        [18.87651, -96.9174],
        [18.87673, -96.91765],
        [18.87724, -96.91822],
        [18.87748, -96.91849],
        [18.87802, -96.91901],
        [18.87828, -96.91925],
        [18.87843, -96.91937],
        [18.87916, -96.92002],
        [18.87988, -96.9207],
        [18.88037, -96.92114],
        [18.88045, -96.92121],
        [18.88088, -96.92161],
        [18.881, -96.92171],
        [18.88131, -96.92195],
        [18.88134, -96.92198],
        [18.88141, -96.92203],
        [18.88158, -96.92212],
        [18.88159, -96.92213],
        [18.88222, -96.92248],
        [18.88291, -96.92294],
        [18.88318, -96.92313],
        [18.88343, -96.92332],
        [18.88366, -96.92351],
        [18.88385, -96.92363],
        [18.88392, -96.92367],
        [18.88399, -96.92372],
        [18.88428, -96.92388],
        [18.88456, -96.92405],
        [18.88458, -96.92406],
        [18.88459, -96.92407],
        [18.88459, -96.92408],
        [18.8846, -96.92409],
        [18.88461, -96.92413],
        [18.88476, -96.92424],
        [18.88524, -96.92456],
        [18.88541, -96.92465],
        [18.88619, -96.92515],
        [18.88625, -96.92518],
        [18.88631, -96.92524],
        [18.88664, -96.92559],
        [18.88757, -96.92669],
        [18.88798, -96.92629],
        [18.88856, -96.92695],
        [18.8888, -96.92724],
        [18.88913, -96.92767],
        [18.88973, -96.92833],
        [18.88973, -96.92833],
        [18.89033, -96.92902],
        [18.89097, -96.92971],
        [18.89158, -96.93038],
        [18.8919, -96.9308],
        [18.8921, -96.93102],
        [18.89275, -96.93177],
        [18.89321, -96.93136],
        [18.89352, -96.9311],
        [18.89422, -96.93052],
        [18.89462, -96.93019],
        [18.89394, -96.92928]
    ];
    cerrarMenuRutas();
    // se traza la ruta de autobus
    rutaBuenaVista = L.polyline(coordenadasRutaBuenaVista, { color: 'red' });
    // se agrega polilinia de ruta a layerGroup grupoCapas
    grupoCapas = L.layerGroup([rutaBuenaVista]);
    // se muestra en el mapa
    grupoCapas.addTo(map);
    // zoom a la ruta
    map.fitBounds(rutaBuenaVista.getBounds());
    agregandoParadasAutobus(paradasRutaBuenaVista);
    abrirMenuParadasRutas();
}